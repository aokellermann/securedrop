#!/usr/bin/env python3

import os
import sys

from securedrop import client

if __name__ == "__main__":
    home_dir = os.getenv("HOME")
    if home_dir is None:
        raise RuntimeError("HOME not found")

    securedrop_dir = os.path.join(home_dir, ".securedrop")
    if not os.path.exists(securedrop_dir):
        os.mkdir(securedrop_dir)
        if not os.path.exists(securedrop_dir):
            raise RuntimeError("Failed to create securedrop directory: $HOME/.securedrop")
    fname = sys.argv[1] if len(sys.argv) >= 2 else "client_db.json"
    securedrop_file = os.path.join(securedrop_dir, fname)
    client.main(filename=securedrop_file)
